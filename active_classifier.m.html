<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>active_classifier API documentation</title>
    <meta name="description" content="" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#active_classifier.colors">colors</a></li>
    <li class="mono"><a href="#active_classifier.markers">markers</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#active_classifier.active_classifier">active_classifier</a></span>
        
          
  <ul>
    <li class="mono"><a href="#active_classifier.active_classifier.__init__">__init__</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.calc_score_">calc_score_</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.evaluate">evaluate</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.exec_cls_fun">exec_cls_fun</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.fit_active">fit_active</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_labeled_x">get_labeled_x</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_labeled_y">get_labeled_y</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_test_scores">get_test_scores</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_train_scores">get_train_scores</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_unlabeled_x">get_unlabeled_x</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.get_unlabeled_y">get_unlabeled_y</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.init_log">init_log</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.init_samples_">init_samples_</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.log_image">log_image</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.save_scores_plot">save_scores_plot</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.set_query_strategy">set_query_strategy</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.set_test_set_">set_test_set_</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.update_labels_">update_labels_</a></li>
    <li class="mono"><a href="#active_classifier.active_classifier.visualize_by_embedding">visualize_by_embedding</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">active_classifier</span> module</h1>
  
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier" class="source">
    <div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.manifold</span> <span class="kn">import</span> <span class="n">TSNE</span><span class="p">,</span><span class="n">MDS</span>

<span class="kn">import</span> <span class="nn">ALeFra.helper</span> <span class="kn">as</span> <span class="nn">helper</span>
<span class="kn">from</span> <span class="nn">ALeFra.helper</span> <span class="kn">import</span> <span class="n">setup_clean_directory</span><span class="p">,</span> <span class="n">annotate_image</span><span class="p">,</span> <span class="n">resize_image_tuple</span><span class="p">,</span> <span class="n">merge_images</span><span class="p">,</span> <span class="n">convert_to_float_images</span><span class="p">,</span> <span class="n">hstack_images</span><span class="p">,</span> <span class="n">vstack_images</span><span class="p">,</span> <span class="n">markers</span><span class="p">,</span><span class="n">colors</span>
<span class="kn">import</span> <span class="nn">ALeFra.active_strategies</span> <span class="kn">as</span> <span class="nn">active_strategies</span>



<span class="k">class</span> <span class="nc">active_classifier</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">classifier</span><span class="p">,</span>
                 <span class="n">x</span><span class="p">,</span>
                 <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">imgs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">predict_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">predict_proba_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">score_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">incremtenal_trainable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">classifier_args</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">classifier_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes an active classifier from base classifier.</span>

<span class="sd">        - **classifier**: The base classifier. Any classifier can be used, just transmit the actual class of the</span>
<span class="sd">        classifier and not an instance of it.</span>
<span class="sd">        - **fit_method**: The method that can train (fit) the classifier as a callback function.</span>
<span class="sd">        - **predict_method**: The predict method of the classifier, should work like classifiers in scikit-learn.</span>
<span class="sd">        - **predict_proba_method**: The predict_proba method is used for estimating the posterior probability in query</span>
<span class="sd">        strategies like uncertainty sampling.</span>
<span class="sd">        - **score_method**: The score method is optional if a different scoreing should be used for visualizing training</span>
<span class="sd">        - **x**: The feature vector used for training. This vector is internally saved and a labeled and unlabeled pool</span>
<span class="sd">        is created based of this.</span>
<span class="sd">        - **y**: The corresponding labels of x</span>
<span class="sd">        - **imgs**: The imgs corresponding to samples of feature vector x. Needed to be displayed by visualization.</span>
<span class="sd">        - **incremtenal_trainable**: If the classifier is trainable online (incremental). If the classifier is not</span>
<span class="sd">        trainable incremental, it is instanciated on each training batch and trained from scratch.</span>
<span class="sd">        - **classifier_args**: Positional arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">        - **classifier_kwargs**: Keyword arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">        Should be passed as a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span> <span class="o">=</span> <span class="n">classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span> <span class="o">=</span> <span class="n">classifier_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span> <span class="o">=</span> <span class="n">classifier_kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span> <span class="o">=</span> <span class="n">fit_method</span> <span class="k">if</span> <span class="n">fit_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_</span> <span class="o">=</span> <span class="n">predict_method</span> <span class="k">if</span> <span class="n">predict_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba_</span> <span class="o">=</span> <span class="n">predict_proba_method</span> <span class="k">if</span> <span class="n">predict_proba_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict_proba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="o">=</span> <span class="n">score_method</span> <span class="c1"># if score_method is not None else None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span> <span class="o">=</span> <span class="n">incremtenal_trainable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_samples_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_query_strategy</span><span class="p">(</span><span class="n">active_strategies</span><span class="o">.</span><span class="n">strategy_query_least_confident</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span> <span class="o">=</span> <span class="p">[]</span>



    <span class="c1">#########################</span>
    <span class="c1">#initialization methods</span>
    <span class="c1">#########################</span>

    <span class="k">def</span> <span class="nf">init_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">export_dir</span><span class="p">,</span><span class="n">visualization_method</span><span class="o">=</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span><span class="n">x_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the log capabilities, visualization method (for creating 2d plot) set a test set (optional corresponding images) and define where to save logged data.</span>
<span class="sd">        - **export_dir**: The visualization images are stored in subdirectories of the passed directory.</span>
<span class="sd">        - **visualization_method**: the visualization method used by feature_visualization method</span>
<span class="sd">        - **x_test**: features of test set</span>
<span class="sd">        - **y_test**: labels of test set</span>
<span class="sd">        - **img_test**: if data set is an image data set, the images can be passed to create nice collages of samples while training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">=</span> <span class="n">visualization_method</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span> <span class="o">=</span> <span class="n">export_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;queried&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_correct&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_false&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;label_change&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;collage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;feature_visualization&#39;</span><span class="p">)</span>


        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_set_</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_samples_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up the training samples and initializes the labeled / unlabeled pool&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imgs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_test_set_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a test set for validating the active learning training procedure. This is necessary in order to call eval_test_set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">img_test</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_false</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">set_query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">strat</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a querying strategy that the active learning should use.</span>

<span class="sd">        - **strat**: Callback function that takes at least 2 arguments:</span>
<span class="sd">            1. Instance of the active_classifier class</span>
<span class="sd">            2. batch size (how many samples should be queryied by the strategy?)</span>
<span class="sd">        - **query_args**: other arguments that are passed to the query function</span>
<span class="sd">        - **query_kwargs**: keyword arguments that are passed to the query function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span> <span class="o">=</span> <span class="n">strat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>




    <span class="c1">#####################################</span>
    <span class="c1">#getter-setter</span>
    <span class="c1">#####################################</span>

    <span class="k">def</span> <span class="nf">get_unlabeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_labeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_unlabeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_labeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">get_train_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_test_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span>












    <span class="k">def</span> <span class="nf">update_labels_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the labeled and unlabeled pool: puts samples from the labeled to unlabeled pool</span>
<span class="sd">        -**unlabeled_pool_indexes**: indices of samples from unlabeled pool to put in labeled pool (because they have been labeled and trained)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">[</span><span class="n">unlabeled_pool_indexes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">,</span><span class="n">indexes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indexes</span>

    <span class="k">def</span> <span class="nf">fit_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use this function to train the classifier. The functions calls the querying function to query the best samples,</span>
<span class="sd">        then those samples gets labeled automatically and the labeled and unlabeled pool are adjusted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;there is no sample in unlabeled pool to train&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">query_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;no sample queried&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">()[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;for classifiers that are not able to train incrementally/online, reinitialize a new classifier and train from scratch with all yet labeled samples&quot;&quot;&quot;</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to train, maybe not enough labeled samples&#39;</span><span class="p">)</span>
                <span class="c1"># print(traceback.format_exc())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">indices</span>


    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">score_train_set</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_collage_image</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_single_images</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the train and test set and creates images of the progress and accuracy. Call this function after *fit_active* to monitor</span>
<span class="sd">        the progress of the active learning training. Images are saved to output dir, that you can change in the *__init__*.</span>
<span class="sd">        - **score_train_set**: Also score train set.</span>
<span class="sd">        - **log_single_images**: if True, single images are saved (one image for each batch which shows: queried samples,</span>
<span class="sd">        new correct samples, new false sampled and samples which label was changed)</span>
<span class="sd">        - **log_collage_image**: if True, a collage image of single images from above is saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">score_train_set</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">predicted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to score train set&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>



        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;error in predict, cant eval_test_set&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
        <span class="n">new_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_correct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_false</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_false</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_change</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">test_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_score</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_single_images</span> <span class="ow">or</span> <span class="n">log_collage_image</span><span class="p">:</span>
                <span class="c1"># save the images queried for the last batch</span>
                <span class="n">img_last_queried</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span><span class="p">])</span>
                <span class="c1"># save the images that are correct for the last batch and that weren&#39;t correct in the batch before</span>
                <span class="n">img_new_correct</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span><span class="p">])</span>
                <span class="c1"># save the images that were correct before and since the last batch are not correct anymore</span>
                <span class="n">img_new_false</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span><span class="p">])</span>
                <span class="c1"># save the images which label did changed since last batch (could also be wrong label to wrong label)</span>
                <span class="n">img_label_change</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span><span class="p">])</span>

            <span class="c1"># log single images</span>
            <span class="k">if</span> <span class="n">log_single_images</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_last_queried</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_correct</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_false</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_label_change</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
            <span class="c1"># log nicely collage image</span>
            <span class="k">if</span> <span class="n">log_collage_image</span><span class="p">:</span>
                <span class="n">queried_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;queried samples&#39;</span><span class="p">)</span>
                <span class="n">correct_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new correct samples&#39;</span><span class="p">)</span>
                <span class="n">false_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new false samples&#39;</span><span class="p">)</span>
                <span class="n">label_changed_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;label changed samples&#39;</span><span class="p">)</span>

                <span class="n">collage</span> <span class="o">=</span> <span class="n">hstack_images</span><span class="p">(</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">queried_txt</span><span class="p">,</span><span class="n">img_last_queried</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">correct_txt</span><span class="p">,</span><span class="n">img_new_correct</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">false_txt</span><span class="p">,</span><span class="n">img_new_false</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">label_changed_txt</span><span class="p">,</span><span class="n">img_label_change</span><span class="p">),</span><span class="n">scale_to_max_height</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">collage</span> <span class="o">=</span> <span class="n">vstack_images</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),(</span><span class="s1">&#39;Accurracy: </span><span class="si">%f</span><span class="s1">, Gain: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))),</span><span class="n">scale_to_max_width</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
        <span class="c1"># save variables from this batch to the variables related to the last batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span>



    <span class="k">def</span> <span class="nf">visualize_by_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is called e.g. after each trained batch (fit_active) to create a 2d-visualization of the training progress. The visualization</span>
<span class="sd">        embedding is created at the first call to visualize_by_embedding and may take a couple of minutes to calculate (depends on the size of the data set).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>


        <span class="c1"># do dimension reduction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;tsne&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;tsne&#39;</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating tsne visualization&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">early_exaggeration</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
                                       <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_iter_without_progress</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">min_grad_norm</span><span class="o">=</span><span class="mf">1e-07</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                       <span class="n">init</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;barnes_hut&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;mds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mds&#39;</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating mds visualization&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mds</span> <span class="o">=</span> <span class="n">MDS</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                   <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dissimilarity</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mds</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>

            <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ux</span><span class="p">,</span><span class="n">uy</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>  <span class="c1"># some_colors[int(y)]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>  <span class="c1"># some_colors[int(y)]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feature Visualization. Train-score: </span><span class="si">%5f</span><span class="s1">, test-score: </span><span class="si">%5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_scores_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves a score plot (test and train accuracies).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Active learning scores. Final Test-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, Final Train-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Batch&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span> <span class="s1">&#39;scores.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>







    <span class="c1">###############################</span>
    <span class="c1">#helper</span>
    <span class="c1">###############################</span>

    <span class="k">def</span> <span class="nf">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">helper</span><span class="o">.</span><span class="n">zero_one_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="nb">dir</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">img</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">exec_cls_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fun</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span><span class="nb">property</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="active_classifier.colors" class="name">var <span class="ident">colors</span></p>
      
  
  <div class="source_cont">
</div>

      </div>
      <div class="item">
      <p id="active_classifier.markers" class="name">var <span class="ident">markers</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="active_classifier.active_classifier" class="name">class <span class="ident">active_classifier</span></p>
      
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">active_classifier</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">classifier</span><span class="p">,</span>
                 <span class="n">x</span><span class="p">,</span>
                 <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">imgs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">fit_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">predict_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">predict_proba_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">score_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">incremtenal_trainable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">classifier_args</span><span class="o">=</span><span class="p">(),</span>
                 <span class="n">classifier_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
                 <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes an active classifier from base classifier.</span>

<span class="sd">        - **classifier**: The base classifier. Any classifier can be used, just transmit the actual class of the</span>
<span class="sd">        classifier and not an instance of it.</span>
<span class="sd">        - **fit_method**: The method that can train (fit) the classifier as a callback function.</span>
<span class="sd">        - **predict_method**: The predict method of the classifier, should work like classifiers in scikit-learn.</span>
<span class="sd">        - **predict_proba_method**: The predict_proba method is used for estimating the posterior probability in query</span>
<span class="sd">        strategies like uncertainty sampling.</span>
<span class="sd">        - **score_method**: The score method is optional if a different scoreing should be used for visualizing training</span>
<span class="sd">        - **x**: The feature vector used for training. This vector is internally saved and a labeled and unlabeled pool</span>
<span class="sd">        is created based of this.</span>
<span class="sd">        - **y**: The corresponding labels of x</span>
<span class="sd">        - **imgs**: The imgs corresponding to samples of feature vector x. Needed to be displayed by visualization.</span>
<span class="sd">        - **incremtenal_trainable**: If the classifier is trainable online (incremental). If the classifier is not</span>
<span class="sd">        trainable incremental, it is instanciated on each training batch and trained from scratch.</span>
<span class="sd">        - **classifier_args**: Positional arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">        - **classifier_kwargs**: Keyword arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">        Should be passed as a dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span> <span class="o">=</span> <span class="n">classifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span> <span class="o">=</span> <span class="n">classifier_args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span> <span class="o">=</span> <span class="n">classifier_kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span> <span class="o">=</span> <span class="n">fit_method</span> <span class="k">if</span> <span class="n">fit_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_</span> <span class="o">=</span> <span class="n">predict_method</span> <span class="k">if</span> <span class="n">predict_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba_</span> <span class="o">=</span> <span class="n">predict_proba_method</span> <span class="k">if</span> <span class="n">predict_proba_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict_proba</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="o">=</span> <span class="n">score_method</span> <span class="c1"># if score_method is not None else None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span> <span class="o">=</span> <span class="n">incremtenal_trainable</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init_samples_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_query_strategy</span><span class="p">(</span><span class="n">active_strategies</span><span class="o">.</span><span class="n">strategy_query_least_confident</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span> <span class="o">=</span> <span class="p">[]</span>



    <span class="c1">#########################</span>
    <span class="c1">#initialization methods</span>
    <span class="c1">#########################</span>

    <span class="k">def</span> <span class="nf">init_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">export_dir</span><span class="p">,</span><span class="n">visualization_method</span><span class="o">=</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span><span class="n">x_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the log capabilities, visualization method (for creating 2d plot) set a test set (optional corresponding images) and define where to save logged data.</span>
<span class="sd">        - **export_dir**: The visualization images are stored in subdirectories of the passed directory.</span>
<span class="sd">        - **visualization_method**: the visualization method used by feature_visualization method</span>
<span class="sd">        - **x_test**: features of test set</span>
<span class="sd">        - **y_test**: labels of test set</span>
<span class="sd">        - **img_test**: if data set is an image data set, the images can be passed to create nice collages of samples while training</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">=</span> <span class="n">visualization_method</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span> <span class="o">=</span> <span class="n">export_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;queried&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_correct&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_false&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;label_change&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;collage&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;feature_visualization&#39;</span><span class="p">)</span>


        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
        <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_test_set_</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_samples_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets up the training samples and initializes the labeled / unlabeled pool&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imgs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">set_test_set_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a test set for validating the active learning training procedure. This is necessary in order to call eval_test_set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">img_test</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_false</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>


    <span class="k">def</span> <span class="nf">set_query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">strat</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets a querying strategy that the active learning should use.</span>

<span class="sd">        - **strat**: Callback function that takes at least 2 arguments:</span>
<span class="sd">            1. Instance of the active_classifier class</span>
<span class="sd">            2. batch size (how many samples should be queryied by the strategy?)</span>
<span class="sd">        - **query_args**: other arguments that are passed to the query function</span>
<span class="sd">        - **query_kwargs**: keyword arguments that are passed to the query function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span> <span class="o">=</span> <span class="n">strat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>




    <span class="c1">#####################################</span>
    <span class="c1">#getter-setter</span>
    <span class="c1">#####################################</span>

    <span class="k">def</span> <span class="nf">get_unlabeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_labeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_unlabeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">get_labeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">get_train_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_test_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span>












    <span class="k">def</span> <span class="nf">update_labels_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Updates the labeled and unlabeled pool: puts samples from the labeled to unlabeled pool</span>
<span class="sd">        -**unlabeled_pool_indexes**: indices of samples from unlabeled pool to put in labeled pool (because they have been labeled and trained)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">[</span><span class="n">unlabeled_pool_indexes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">,</span><span class="n">indexes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indexes</span>

    <span class="k">def</span> <span class="nf">fit_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use this function to train the classifier. The functions calls the querying function to query the best samples,</span>
<span class="sd">        then those samples gets labeled automatically and the labeled and unlabeled pool are adjusted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;there is no sample in unlabeled pool to train&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">query_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;no sample queried&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">()[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="sd">&quot;&quot;&quot;for classifiers that are not able to train incrementally/online, reinitialize a new classifier and train from scratch with all yet labeled samples&quot;&quot;&quot;</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to train, maybe not enough labeled samples&#39;</span><span class="p">)</span>
                <span class="c1"># print(traceback.format_exc())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">indices</span>


    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">score_train_set</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_collage_image</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_single_images</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the train and test set and creates images of the progress and accuracy. Call this function after *fit_active* to monitor</span>
<span class="sd">        the progress of the active learning training. Images are saved to output dir, that you can change in the *__init__*.</span>
<span class="sd">        - **score_train_set**: Also score train set.</span>
<span class="sd">        - **log_single_images**: if True, single images are saved (one image for each batch which shows: queried samples,</span>
<span class="sd">        new correct samples, new false sampled and samples which label was changed)</span>
<span class="sd">        - **log_collage_image**: if True, a collage image of single images from above is saved.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">score_train_set</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">predicted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to score train set&#39;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>



        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;error in predict, cant eval_test_set&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
        <span class="n">new_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_correct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">new_false</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_false</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">label_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_change</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">test_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_score</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log_single_images</span> <span class="ow">or</span> <span class="n">log_collage_image</span><span class="p">:</span>
                <span class="c1"># save the images queried for the last batch</span>
                <span class="n">img_last_queried</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span><span class="p">])</span>
                <span class="c1"># save the images that are correct for the last batch and that weren&#39;t correct in the batch before</span>
                <span class="n">img_new_correct</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span><span class="p">])</span>
                <span class="c1"># save the images that were correct before and since the last batch are not correct anymore</span>
                <span class="n">img_new_false</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span><span class="p">])</span>
                <span class="c1"># save the images which label did changed since last batch (could also be wrong label to wrong label)</span>
                <span class="n">img_label_change</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span><span class="p">])</span>

            <span class="c1"># log single images</span>
            <span class="k">if</span> <span class="n">log_single_images</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_last_queried</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_correct</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_false</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_label_change</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
            <span class="c1"># log nicely collage image</span>
            <span class="k">if</span> <span class="n">log_collage_image</span><span class="p">:</span>
                <span class="n">queried_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;queried samples&#39;</span><span class="p">)</span>
                <span class="n">correct_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new correct samples&#39;</span><span class="p">)</span>
                <span class="n">false_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new false samples&#39;</span><span class="p">)</span>
                <span class="n">label_changed_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;label changed samples&#39;</span><span class="p">)</span>

                <span class="n">collage</span> <span class="o">=</span> <span class="n">hstack_images</span><span class="p">(</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">queried_txt</span><span class="p">,</span><span class="n">img_last_queried</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">correct_txt</span><span class="p">,</span><span class="n">img_new_correct</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">false_txt</span><span class="p">,</span><span class="n">img_new_false</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">label_changed_txt</span><span class="p">,</span><span class="n">img_label_change</span><span class="p">),</span><span class="n">scale_to_max_height</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">collage</span> <span class="o">=</span> <span class="n">vstack_images</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),(</span><span class="s1">&#39;Accurracy: </span><span class="si">%f</span><span class="s1">, Gain: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))),</span><span class="n">scale_to_max_width</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
        <span class="c1"># save variables from this batch to the variables related to the last batch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span>



    <span class="k">def</span> <span class="nf">visualize_by_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is called e.g. after each trained batch (fit_active) to create a 2d-visualization of the training progress. The visualization</span>
<span class="sd">        embedding is created at the first call to visualize_by_embedding and may take a couple of minutes to calculate (depends on the size of the data set).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>


        <span class="c1"># do dimension reduction</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;tsne&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;tsne&#39;</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating tsne visualization&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">early_exaggeration</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
                                       <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_iter_without_progress</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">min_grad_norm</span><span class="o">=</span><span class="mf">1e-07</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                       <span class="n">init</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;barnes_hut&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;mds&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mds&#39;</span><span class="p">):</span>
                    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating mds visualization&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mds</span> <span class="o">=</span> <span class="n">MDS</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                   <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dissimilarity</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mds</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>

            <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ux</span><span class="p">,</span><span class="n">uy</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>  <span class="c1"># some_colors[int(y)]</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>  <span class="c1"># some_colors[int(y)]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feature Visualization. Train-score: </span><span class="si">%5f</span><span class="s1">, test-score: </span><span class="si">%5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_scores_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Saves a score plot (test and train accuracies).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Active learning scores. Final Test-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, Final Train-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Batch&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span> <span class="s1">&#39;scores.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>







    <span class="c1">###############################</span>
    <span class="c1">#helper</span>
    <span class="c1">###############################</span>

    <span class="k">def</span> <span class="nf">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">helper</span><span class="o">.</span><span class="n">zero_one_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="nb">dir</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">img</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">exec_cls_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fun</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span><span class="nb">property</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#active_classifier.active_classifier">active_classifier</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, classifier, x, y=None, imgs=None, fit_method=None, predict_method=None, predict_proba_method=None, score_method=None, incremtenal_trainable=True, classifier_args=(), classifier_kwargs={})</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes an active classifier from base classifier.</p>
<ul>
<li><strong>classifier</strong>: The base classifier. Any classifier can be used, just transmit the actual class of the
classifier and not an instance of it.</li>
<li><strong>fit_method</strong>: The method that can train (fit) the classifier as a callback function.</li>
<li><strong>predict_method</strong>: The predict method of the classifier, should work like classifiers in scikit-learn.</li>
<li><strong>predict_proba_method</strong>: The predict_proba method is used for estimating the posterior probability in query
strategies like uncertainty sampling.</li>
<li><strong>score_method</strong>: The score method is optional if a different scoreing should be used for visualizing training</li>
<li><strong>x</strong>: The feature vector used for training. This vector is internally saved and a labeled and unlabeled pool
is created based of this.</li>
<li><strong>y</strong>: The corresponding labels of x</li>
<li><strong>imgs</strong>: The imgs corresponding to samples of feature vector x. Needed to be displayed by visualization.</li>
<li><strong>incremtenal_trainable</strong>: If the classifier is trainable online (incremental). If the classifier is not
trainable incremental, it is instanciated on each training batch and trained from scratch.</li>
<li><strong>classifier_args</strong>: Positional arguments which are passed to the classifier when it is instanciated.</li>
<li><strong>classifier_kwargs</strong>: Keyword arguments which are passed to the classifier when it is instanciated.
Should be passed as a dict.</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.__init__', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">classifier</span><span class="p">,</span>
             <span class="n">x</span><span class="p">,</span>
             <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">imgs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">fit_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">predict_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">predict_proba_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">score_method</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">incremtenal_trainable</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">classifier_args</span><span class="o">=</span><span class="p">(),</span>
             <span class="n">classifier_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
             <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Initializes an active classifier from base classifier.</span>
<span class="sd">    - **classifier**: The base classifier. Any classifier can be used, just transmit the actual class of the</span>
<span class="sd">    classifier and not an instance of it.</span>
<span class="sd">    - **fit_method**: The method that can train (fit) the classifier as a callback function.</span>
<span class="sd">    - **predict_method**: The predict method of the classifier, should work like classifiers in scikit-learn.</span>
<span class="sd">    - **predict_proba_method**: The predict_proba method is used for estimating the posterior probability in query</span>
<span class="sd">    strategies like uncertainty sampling.</span>
<span class="sd">    - **score_method**: The score method is optional if a different scoreing should be used for visualizing training</span>
<span class="sd">    - **x**: The feature vector used for training. This vector is internally saved and a labeled and unlabeled pool</span>
<span class="sd">    is created based of this.</span>
<span class="sd">    - **y**: The corresponding labels of x</span>
<span class="sd">    - **imgs**: The imgs corresponding to samples of feature vector x. Needed to be displayed by visualization.</span>
<span class="sd">    - **incremtenal_trainable**: If the classifier is trainable online (incremental). If the classifier is not</span>
<span class="sd">    trainable incremental, it is instanciated on each training batch and trained from scratch.</span>
<span class="sd">    - **classifier_args**: Positional arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">    - **classifier_kwargs**: Keyword arguments which are passed to the classifier when it is instanciated.</span>
<span class="sd">    Should be passed as a dict.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span> <span class="o">=</span> <span class="n">classifier</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span> <span class="o">=</span> <span class="n">classifier_args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span> <span class="o">=</span> <span class="n">classifier_kwargs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span> <span class="o">=</span> <span class="n">fit_method</span> <span class="k">if</span> <span class="n">fit_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">fit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predict_</span> <span class="o">=</span> <span class="n">predict_method</span> <span class="k">if</span> <span class="n">predict_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predict_proba_</span> <span class="o">=</span> <span class="n">predict_proba_method</span> <span class="k">if</span> <span class="n">predict_proba_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="o">.</span><span class="n">predict_proba</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="o">=</span> <span class="n">score_method</span> <span class="c1"># if score_method is not None else None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span> <span class="o">=</span> <span class="n">incremtenal_trainable</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">init_samples_</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_query_strategy</span><span class="p">(</span><span class="n">active_strategies</span><span class="o">.</span><span class="n">strategy_query_least_confident</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.calc_score_">
    <p>def <span class="ident">calc_score_</span>(</p><p>self, prediction, target)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.calc_score_', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.calc_score_" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">helper</span><span class="o">.</span><span class="n">zero_one_loss</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span><span class="n">target</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.evaluate">
    <p>def <span class="ident">evaluate</span>(</p><p>self, score_train_set=True, log_collage_image=True, log_single_images=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Evaluate the train and test set and creates images of the progress and accuracy. Call this function after <em>fit_active</em> to monitor
the progress of the active learning training. Images are saved to output dir, that you can change in the <em><strong>init</strong></em>.
- <strong>score_train_set</strong>: Also score train set.
- <strong>log_single_images</strong>: if True, single images are saved (one image for each batch which shows: queried samples,
new correct samples, new false sampled and samples which label was changed)
- <strong>log_collage_image</strong>: if True, a collage image of single images from above is saved.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.evaluate', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.evaluate" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">score_train_set</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_collage_image</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">log_single_images</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Evaluate the train and test set and creates images of the progress and accuracy. Call this function after *fit_active* to monitor</span>
<span class="sd">    the progress of the active learning training. Images are saved to output dir, that you can change in the *__init__*.</span>
<span class="sd">    - **score_train_set**: Also score train set.</span>
<span class="sd">    - **log_single_images**: if True, single images are saved (one image for each batch which shows: queried samples,</span>
<span class="sd">    new correct samples, new false sampled and samples which label was changed)</span>
<span class="sd">    - **log_collage_image**: if True, a collage image of single images from above is saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">score_train_set</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">predicted_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="n">predicted_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to score train set&#39;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predict_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_test</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;error in predict, cant eval_test_set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
    <span class="n">new_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_correct</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_false</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_false</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">label_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">label_change</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">test_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_score_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_score</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">log_single_images</span> <span class="ow">or</span> <span class="n">log_collage_image</span><span class="p">:</span>
            <span class="c1"># save the images queried for the last batch</span>
            <span class="n">img_last_queried</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span><span class="p">])</span>
            <span class="c1"># save the images that are correct for the last batch and that weren&#39;t correct in the batch before</span>
            <span class="n">img_new_correct</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span><span class="p">])</span>
            <span class="c1"># save the images that were correct before and since the last batch are not correct anymore</span>
            <span class="n">img_new_false</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span><span class="p">])</span>
            <span class="c1"># save the images which label did changed since last batch (could also be wrong label to wrong label)</span>
            <span class="n">img_label_change</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">merge_images_or_placeholder</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">label_change_i</span><span class="p">])</span>
        <span class="c1"># log single images</span>
        <span class="k">if</span> <span class="n">log_single_images</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_last_queried</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_correct</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_new_false</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">img_label_change</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
        <span class="c1"># log nicely collage image</span>
        <span class="k">if</span> <span class="n">log_collage_image</span><span class="p">:</span>
            <span class="n">queried_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;queried samples&#39;</span><span class="p">)</span>
            <span class="n">correct_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new correct samples&#39;</span><span class="p">)</span>
            <span class="n">false_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;new false samples&#39;</span><span class="p">)</span>
            <span class="n">label_changed_txt</span> <span class="o">=</span> <span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;label changed samples&#39;</span><span class="p">)</span>
            <span class="n">collage</span> <span class="o">=</span> <span class="n">hstack_images</span><span class="p">(</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">queried_txt</span><span class="p">,</span><span class="n">img_last_queried</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">correct_txt</span><span class="p">,</span><span class="n">img_new_correct</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">false_txt</span><span class="p">,</span><span class="n">img_new_false</span><span class="p">),</span><span class="n">vstack_images</span><span class="p">(</span><span class="n">label_changed_txt</span><span class="p">,</span><span class="n">img_label_change</span><span class="p">),</span><span class="n">scale_to_max_height</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">collage</span> <span class="o">=</span> <span class="n">vstack_images</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="n">annotate_image</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3</span><span class="p">)),(</span><span class="s1">&#39;Accurracy: </span><span class="si">%f</span><span class="s1">, Gain: </span><span class="si">%f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))),</span><span class="n">scale_to_max_width</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_image</span><span class="p">(</span><span class="n">collage</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
    <span class="c1"># save variables from this batch to the variables related to the last batch</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_correct_i</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_false_i</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_predicted</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.exec_cls_fun">
    <p>def <span class="ident">exec_cls_fun</span>(</p><p>self, fun, *args, **kwargs)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.exec_cls_fun', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.exec_cls_fun" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">exec_cls_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fun</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span><span class="nb">property</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.fit_active">
    <p>def <span class="ident">fit_active</span>(</p><p>self, batch_size)</p>
    </div>
    

    
  
    <div class="desc"><p>Use this function to train the classifier. The functions calls the querying function to query the best samples,
then those samples gets labeled automatically and the labeled and unlabeled pool are adjusted.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.fit_active', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.fit_active" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">fit_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Use this function to train the classifier. The functions calls the querying function to query the best samples,</span>
<span class="sd">    then those samples gets labeled automatically and the labeled and unlabeled pool are adjusted.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;there is no sample in unlabeled pool to train&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">batch_size</span><span class="p">,</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">query_args</span><span class="p">,</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;no sample queried&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">incremental_trainable</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">()[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">()[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;for classifiers that are not able to train incrementally/online, reinitialize a new classifier and train from scratch with all yet labeled samples&quot;&quot;&quot;</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_labels_</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classifier_</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">classifier_kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fit_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cls</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;unable to train, maybe not enough labeled samples&#39;</span><span class="p">)</span>
            <span class="c1"># print(traceback.format_exc())</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_queried_i_</span> <span class="o">=</span> <span class="n">indices</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">indices</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_labeled_x">
    <p>def <span class="ident">get_labeled_x</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_labeled_x', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_labeled_x" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_labeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_labeled_y">
    <p>def <span class="ident">get_labeled_y</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_labeled_y', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_labeled_y" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_labeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_test_scores">
    <p>def <span class="ident">get_test_scores</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_test_scores', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_test_scores" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_test_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_train_scores">
    <p>def <span class="ident">get_train_scores</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_train_scores', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_train_scores" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_train_scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_labeled</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_unlabeled</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_unlabeled_x">
    <p>def <span class="ident">get_unlabeled_x</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_unlabeled_x', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_unlabeled_x" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_unlabeled_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.get_unlabeled_y">
    <p>def <span class="ident">get_unlabeled_y</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.get_unlabeled_y', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.get_unlabeled_y" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_unlabeled_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">]</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.init_log">
    <p>def <span class="ident">init_log</span>(</p><p>self, export_dir, visualization_method=&#39;tsne&#39;, x_test=None, y_test=None, img_test=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Initializes the log capabilities, visualization method (for creating 2d plot) set a test set (optional corresponding images) and define where to save logged data.
- <strong>export_dir</strong>: The visualization images are stored in subdirectories of the passed directory.
- <strong>visualization_method</strong>: the visualization method used by feature_visualization method
- <strong>x_test</strong>: features of test set
- <strong>y_test</strong>: labels of test set
- <strong>img_test</strong>: if data set is an image data set, the images can be passed to create nice collages of samples while training</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.init_log', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.init_log" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">init_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">export_dir</span><span class="p">,</span><span class="n">visualization_method</span><span class="o">=</span><span class="s1">&#39;tsne&#39;</span><span class="p">,</span><span class="n">x_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">y_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Initializes the log capabilities, visualization method (for creating 2d plot) set a test set (optional corresponding images) and define where to save logged data.</span>
<span class="sd">    - **export_dir**: The visualization images are stored in subdirectories of the passed directory.</span>
<span class="sd">    - **visualization_method**: the visualization method used by feature_visualization method</span>
<span class="sd">    - **x_test**: features of test set</span>
<span class="sd">    - **y_test**: labels of test set</span>
<span class="sd">    - **img_test**: if data set is an image data set, the images can be passed to create nice collages of samples while training</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">=</span> <span class="n">visualization_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span> <span class="o">=</span> <span class="n">export_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;queried&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_correct&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;new_false&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;label_change&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;collage&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="s1">&#39;feature_visualization&#39;</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_QUERIED</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_CORRECT</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_NEW_FALSE</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_LABEL_CHANGE</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_COLLAGE</span><span class="p">)</span>
    <span class="n">setup_clean_directory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_test_set_</span><span class="p">(</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.init_samples_">
    <p>def <span class="ident">init_samples_</span>(</p><p>self, x, y, imgs)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets up the training samples and initializes the labeled / unlabeled pool</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.init_samples_', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.init_samples_" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">init_samples_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">imgs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets up the training samples and initializes the labeled / unlabeled pool&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">imgs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">imgs</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgs</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.log_image">
    <p>def <span class="ident">log_image</span>(</p><p>self, img, dir)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.log_image', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.log_image" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">log_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">img</span><span class="p">,</span><span class="nb">dir</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">img</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.save_scores_plot">
    <p>def <span class="ident">save_scores_plot</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Saves a score plot (test and train accuracies).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.save_scores_plot', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.save_scores_plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save_scores_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Saves a score plot (test and train accuracies).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Active learning scores. Final Test-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;, Final Train-Accuracy: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Test Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Train Accuracy&#39;</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Batch&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Accuracy&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_EXPORT</span><span class="p">,</span> <span class="s1">&#39;scores.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.set_query_strategy">
    <p>def <span class="ident">set_query_strategy</span>(</p><p>self, strat, *args, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets a querying strategy that the active learning should use.</p>
<ul>
<li><strong>strat</strong>: Callback function that takes at least 2 arguments:<ol>
<li>Instance of the active_classifier class</li>
<li>batch size (how many samples should be queryied by the strategy?)</li>
</ol>
</li>
<li><strong>query_args</strong>: other arguments that are passed to the query function</li>
<li><strong>query_kwargs</strong>: keyword arguments that are passed to the query function</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.set_query_strategy', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.set_query_strategy" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_query_strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">strat</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets a querying strategy that the active learning should use.</span>
<span class="sd">    - **strat**: Callback function that takes at least 2 arguments:</span>
<span class="sd">        1. Instance of the active_classifier class</span>
<span class="sd">        2. batch size (how many samples should be queryied by the strategy?)</span>
<span class="sd">    - **query_args**: other arguments that are passed to the query function</span>
<span class="sd">    - **query_kwargs**: keyword arguments that are passed to the query function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_strategy</span> <span class="o">=</span> <span class="n">strat</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.set_test_set_">
    <p>def <span class="ident">set_test_set_</span>(</p><p>self, x_test, y_test, img_test=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Sets a test set for validating the active learning training procedure. This is necessary in order to call eval_test_set.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.set_test_set_', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.set_test_set_" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">set_test_set_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">,</span><span class="n">img_test</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sets a test set for validating the active learning training procedure. This is necessary in order to call eval_test_set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">img_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="n">helper</span><span class="o">.</span><span class="n">preprocess_images</span><span class="p">(</span><span class="n">img_test</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imgs_test</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_correct</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">test_false</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_correct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_correct_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_new_false_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_test_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.update_labels_">
    <p>def <span class="ident">update_labels_</span>(</p><p>self, unlabeled_pool_indexes)</p>
    </div>
    

    
  
    <div class="desc"><p>Updates the labeled and unlabeled pool: puts samples from the labeled to unlabeled pool
-<strong>unlabeled_pool_indexes</strong>: indices of samples from unlabeled pool to put in labeled pool (because they have been labeled and trained)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.update_labels_', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.update_labels_" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">update_labels_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Updates the labeled and unlabeled pool: puts samples from the labeled to unlabeled pool</span>
<span class="sd">    -**unlabeled_pool_indexes**: indices of samples from unlabeled pool to put in labeled pool (because they have been labeled and trained)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">[</span><span class="n">unlabeled_pool_indexes</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">,</span><span class="n">unlabeled_pool_indexes</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">,</span><span class="n">indexes</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indexes</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="active_classifier.active_classifier.visualize_by_embedding">
    <p>def <span class="ident">visualize_by_embedding</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Is called e.g. after each trained batch (fit_active) to create a 2d-visualization of the training progress. The visualization
embedding is created at the first call to visualize_by_embedding and may take a couple of minutes to calculate (depends on the size of the data set).</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-active_classifier.active_classifier.visualize_by_embedding', this);">Show source &equiv;</a></p>
  <div id="source-active_classifier.active_classifier.visualize_by_embedding" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">visualize_by_embedding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Is called e.g. after each trained batch (fit_active) to create a 2d-visualization of the training progress. The visualization</span>
<span class="sd">    embedding is created at the first call to visualize_by_embedding and may take a couple of minutes to calculate (depends on the size of the data set).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
    <span class="c1"># do dimension reduction</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;tsne&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;tsne&#39;</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating tsne visualization&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span> <span class="o">=</span> <span class="n">TSNE</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">perplexity</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span> <span class="n">early_exaggeration</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
                                   <span class="n">n_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_iter_without_progress</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">min_grad_norm</span><span class="o">=</span><span class="mf">1e-07</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span>
                                   <span class="n">init</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;barnes_hut&#39;</span><span class="p">,</span> <span class="n">angle</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tsne</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualization_method</span> <span class="o">==</span> <span class="s1">&#39;mds&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mds&#39;</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="s1">&#39;calculating mds visualization&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mds</span> <span class="o">=</span> <span class="n">MDS</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">n_init</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                               <span class="n">n_jobs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dissimilarity</span><span class="o">=</span><span class="s1">&#39;euclidean&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mds</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_</span><span class="p">)</span>
        <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">unlabeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_visu</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">labeled_i_</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unlabeled_y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_labeled_y</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ux</span><span class="p">,</span><span class="n">uy</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>  <span class="c1"># some_colors[int(y)]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lx</span><span class="p">,</span><span class="n">ly</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="n">markers</span><span class="p">[</span><span class="n">y</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">y</span><span class="p">])</span>  <span class="c1"># some_colors[int(y)]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Feature Visualization. Train-score: </span><span class="si">%5f</span><span class="s1">, test-score: </span><span class="si">%5f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_scores_whole</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">test_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIR_FEATURE_VISUALIZATION</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch_counter_</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">),</span> <span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="active_classifier.active_classifier.classifier_" class="name">var <span class="ident">classifier_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.classifier_args" class="name">var <span class="ident">classifier_args</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.classifier_kwargs" class="name">var <span class="ident">classifier_kwargs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.cls" class="name">var <span class="ident">cls</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.epoch_counter_" class="name">var <span class="ident">epoch_counter_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.fit_" class="name">var <span class="ident">fit_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.incremental_trainable" class="name">var <span class="ident">incremental_trainable</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.predict_" class="name">var <span class="ident">predict_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.predict_proba_" class="name">var <span class="ident">predict_proba_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.score_" class="name">var <span class="ident">score_</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.train_scores_labeled" class="name">var <span class="ident">train_scores_labeled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.train_scores_unlabeled" class="name">var <span class="ident">train_scores_unlabeled</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="active_classifier.active_classifier.train_scores_whole" class="name">var <span class="ident">train_scores_whole</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
